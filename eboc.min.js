/**
	Exploding Boxes of Color 	
  
  Author: Dejapong (http://dejapong.com)
  
	This program is free software: you can redistribute it and/or modify
	it under the terms of the GNU General Public License as published by
	the Free Software Foundation, either version 3 of the License, or
	(at your option) any later version.

	This program is distributed in the hope that it will be useful,
	but WITHOUT ANY WARRANTY; without even the implied warranty of
	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
	GNU General Public License for more details.

	You should have received a copy of the GNU General Public License
	along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/
Raphael.fn.matchDrop=function(w,z,u,j,G){var C=0,i=0,I=0,p,s,k=["#de3c29","#c9932d","#007d46","#224360","#912220","#0087fa"],f=["f87060","#f0c779","#26a26b","#487093","#a7413f","#6eabdf"],o=[],y=3,b,m=Raphael(w,z,u),F={},A=true,H=0,E="#252522",n,q,t,x={"font-size":20,fill:"#fff","stroke-width":0,"font-family":"Lobster"},h,l,r=30,c,D=0,g=[{size:15,colors:3},{size:15,colors:4},{size:20,colors:3},{size:20,colors:4},{size:15,colors:5},{size:15,colors:6},{size:25,colors:3},{size:25,colors:4},{size:25,colors:5},{size:25,colors:6},{size:25,colors:1}];function B(){o=[];D=0;C=0;s=0;p=0;t=new Date().getTime();var J=g[D];y=J.colors;h=J.size;l=J.size;G(D+1);v()}function e(){var K=new Date().getTime();var J=K-t;var L=prompt("Enter your name to post your score");if(L==""){alert("You must enter a name to post your score")}if(L!=undefined&&L!=""){var M=document.createElement("form");M.setAttribute("method","post");M.setAttribute("action","postScore.php");var N=document.createElement("input");N.setAttribute("type","hidden");N.setAttribute("name","name");N.setAttribute("value",L);M.appendChild(N);N=document.createElement("input");N.setAttribute("type","hidden");N.setAttribute("name","score");N.setAttribute("value",s);M.appendChild(N);N=document.createElement("input");N.setAttribute("type","hidden");N.setAttribute("name","time");N.setAttribute("value",J);M.appendChild(N);N=document.createElement("input");N.setAttribute("type","hidden");N.setAttribute("name","history");N.setAttribute("value",o);M.appendChild(N);N=document.createElement("input");N.setAttribute("type","hidden");N.setAttribute("name","level");N.setAttribute("value",D);M.appendChild(N);document.body.appendChild(M);M.submit()}}function d(){s=C;var P=0;D=D+1;if(H>0){P+=H*-100}else{P+=1000}P+=(1000-I*10);C+=P;p+=I;if(q){q.attr("text","")}if(D==g.length){q=m.text(z/2,r,"You Won!\nWell Done. Thanks for Playing!");q.attr(x);j(C,I,i);s=C;M()}else{var J=g[D],L=700;y=J.colors;h=J.size;l=J.size;setTimeout(Q,1000)}function Q(){q=m.text(z/2,r,"Level Completed");q.attr(x);setTimeout(R,L)}function R(){q=m.text(z/2,r+150,"Current Score: "+s);q.attr(x);setTimeout(K,L)}function K(){var S;if(H>0){S=m.text(z/2,r+200,"Remaining Blocks: "+(H*-100)+" Points")}else{S=m.text(z/2,r+200,"No Remaining Blocks: 1000 Points")}S.attr(x);setTimeout(O,L)}function O(){var S=m.text(z/2,r+250,"Moves Bonus: "+(1000-I*10)+" Points");S.attr(x);setTimeout(N,L)}function N(){var T=m.text(z/2,r+300,"Final Score: "+C);var S;n=m.rect(z/2-100,360,200,30,5);n.attr({fill:"#c9932d","stroke-width":0,cursor:"pointer"});if(C<0){S=m.text(z/2,374,"Try Again");n.click(B);S.click(B);M()}else{S=m.text(z/2,374,"Next Level");n.click(v);S.click(v);S.attr({cursor:"pointer"})}S.attr(x);T.attr(x)}function M(){var S=m.rect(z/2-100,406,200,30,5);S.attr({fill:"#007d46","stroke-width":0,cursor:"pointer"});q=m.text(z/2,420,"Post Current Score");q.attr(x);q.attr({cursor:"pointer"});S.click(e);q.click(e)}}function a(){H=0;A=false;for(var M=0,J=b.length;M<J;M++){for(var K=0,L=b[M].length;K<L;K++){H++;b[M][K].findGroups(M*l+K)}}if(!A){d()}}function v(){m.clear();b=[];i=0;I=0;o.push("n");c=z/h-2*r/h;j(C,I,i);G(D+1);q=m.text(z/2,r,"");q.attr(x);o.push(h);o.push(l);for(var N=0,K=h;N<K;N++){b[N]=[];for(var L=0,M=l;L<M;L++){var J=Math.floor(Math.random()*y);var O=m.rect(N*c+r,u-L*c-r,c-2,c-2,5);O.attr({fill:k[J],"stroke-width":2,stroke:E});O.type=J;O.column=N;O.row=L;O.id=N*l+L;O.downQ=0;O.leftQ=0;O.marked=false;o.push(J);O.findGroups=function(T){if(this.marked){return}var R=this.column;var Q=this.row;this.marked=true;this.group=T;if(!F[T]){F[T]=0}F[T]++;if(F[T]>1){A=true}var S=[];if(Q<b[R].length){S.push(b[R][Q+1])}if(Q>0){S.push(b[R][Q-1])}if(R>0){S.push(b[R-1][Q])}if(R<b.length-1){S.push(b[R+1][Q])}for(var P=0;P<S.length;P++){if(S[P]){if(S[P].type==this.type){S[P].findGroups(T)}}}};O.click(function(){var Y=F[this.group];if(Y<2){return}q.attr({text:"","font-size":1});if(Y>7){if(Y<15){q.attr({text:"Good Job! x2"})}else{if(Y<20){q.attr({text:"Great Job! x4"})}else{if(Y<25){q.attr({text:"Oh my, Quite Excellent! x8"})}else{if(Y<30){q.attr({text:"Oh, so many Indeed! x16"})}else{q.attr({text:"Force of a Thousand Suns!!! x32"})}}}}}q.animate({"font-size":20,fill:"#fff",y:r},300,"<");var P=Y;if(Y>13&&Y<15){P*=2}if(Y>15&&Y<20){P*=4}if(Y>20&&Y<25){P*=8}if(Y>25&&Y<30){P*=16}if(Y>30){P*=32}C+=P;I++;o.push(this.id);i=Math.max(i,Y);j(C,I,i);var S=[];for(var ab=0,Q=b.length;ab<Q;ab++){var ag=0;var R=b[ab];for(var aa=0,X=R.length;aa<X;aa++){if(R[aa].group==this.group){S.push(R[aa]);for(var Z=aa+1;Z<b[ab].length;Z++){R[Z].downQ+=c;R[Z].row-=1}ag++}}if(ag==R.length){for(ac=ab+1,W=b.length;ac<W;ac++){for(L=0,M=b[ac].length;L<M;L++){var T=b[ac][L];T.column-=1;T.leftQ=-1*c}}}}for(var ab=0,Q=b.length;ab<Q;ab++){var R=b[ab];for(var aa=0,X=R.length;aa<X;aa++){var U=u-aa*c-r;var T=R[aa];var ad=T.downQ;T.animate({y:U+ad},500,"bounce");T.downQ=0;T.marked=false}}for(var ac=0,W=S.length;ac<W;ac++){var T=S[ac];var af=T.column;var R=b[af];R.splice(T.row,1);T.explode();if(R.length==0){b.splice(af,1)}}for(var ab=0,Q=b.length;ab<Q;ab++){for(var aa=0,X=b[ab].length;aa<X;aa++){var T=b[ab][aa];var ae=T.leftQ;if(ae<0){var V=ab*c+r;ae+=c;T.animate({x:V+ae},500,"<");T.leftQ=0;T.marked=false}}}F={};a()});O.mouseout(function(){for(var S=0,P=b.length;S<P;S++){for(var Q=0,R=b[S].length;Q<R;Q++){if(b[S][Q].group==this.group){b[S][Q].attr({fill:k[this.type],stroke:E})}}}});O.mouseover(function(){for(var S=0,P=b.length;S<P;S++){for(var Q=0,R=b[S].length;Q<R;Q++){if(b[S][Q].group==this.group){b[S][Q].attr({fill:f[this.type],stroke:"#fff","stroke-width":2})}}}});O.explode=function(){var Y=this.attr("x");var W=this.attr("y");var S=25;var U=15;var aa=0.1;var P=c*0.5;var R={fill:k[this.type],"stroke-width":0};var Z=[];Z[0]=m.rect(Y,W,P,P,3);Z[1]=m.rect(Y+P,W,P,P,3);for(var T=0;T<2;T++){var V=Z[T];V.attr(R);V.speed=Math.random()*S+U;V.angle=Math.random()*3.14*2}var X=c;var Q=setInterval(function(){for(var ad=0;ad<2;ad++){var ae=Z[ad];var ac=ae.attr("x");var ab=ae.attr("y");if(ae.angle>1.57){if(ae.angle>4.71){ae.angle+=aa;if(ae.angle>7.85){ae.angle=1.57}}else{ae.angle-=aa}}X--;if(X<=0){ae.remove();clearInterval(Q)}ae.attr({x:(ac+ae.speed*Math.cos(ae.angle)),y:(ab+ae.speed*Math.sin(ae.angle)),width:X,height:X})}},60);this.remove()};b[N][L]=O}}q.toFront();a()}window.onload=function(){document.onselectstart=function(){return false};document.onmousedown=function(){return false}};B()};